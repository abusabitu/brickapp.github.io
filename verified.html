<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Brick â€” Email Verification</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#111;background:#fff}
  .site-header{padding:18px 28px;border-bottom:1px solid #eee;background:#fff}
  .logo img{height:40px}
  .hero{padding:60px 20px;text-align:center}
  .hero h1{font-size:2rem;margin-bottom:12px}
  .hero p{color:#555;margin-bottom:24px}
  .form-box{
    max-width:420px;
    margin:0 auto;
    background:#fff;
    border:1px solid #f0f0f0;
    box-shadow:0 10px 30px rgba(0,0,0,.05);
    padding:32px;
    border-radius:12px;
    text-align:center;
  }
  button{
    width:100%;
    padding:14px;
    background:#111;
    color:#fff;
    font-weight:700;
    border:none;
    border-radius:10px;
    cursor:pointer;
    margin-top:16px;
    font-size:1rem;
  }
  button:disabled{background:#aaa;cursor:not-allowed}
  .msg{margin-top:16px;font-size:.95rem;text-align:center;font-weight:600;}
</style>
</head>
<body>

<div class="site-header">
  <div class="logo"><img src="images/logo.png" alt="Brick logo"><strong style="font-size:1.05rem;margin-left:8px">Brick</strong></div>
</div>

<section class="hero">
  <div class="form-box">
    <div id="status-message">
      <h1 id="main-heading">Verifying Email...</h1>
      <p id="sub-text">Please wait while we verify your email address.</p>
    </div>
    <div id="redirect-button" style="display:none;">
      <button onclick="window.location.href='https://brick.com.ng/verified'">Return to App</button>
    </div>
  </div>
</section>

<script>
  const statusEl = document.getElementById("status-message");
  const headingEl = document.getElementById("main-heading");
  const subTextEl = document.getElementById("sub-text");
  const redirectBtnEl = document.getElementById("redirect-button");

  // Extract the token from the URL
  const url = new URL(window.location.href);
  const token = url.searchParams.get("token");

  async function verifyEmail() {
    if (!token) {
      headingEl.textContent = "Invalid Link";
      subTextEl.textContent = "The verification token is missing.";
      return;
    }

    try {
      const res = await fetch("https://x8ki-letl-twmt.n7.xano.io/api:zrt8IXcf/auth/verify_email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token: token })
      });

      const data = await res.json();
      
      if (res.ok) {
        headingEl.textContent = "Email Verified!";
        subTextEl.textContent = "Your email address has been successfully verified. Redirecting to the app...";
        statusEl.innerHTML += '<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-circle" style="margin-top: 20px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.86"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
        
        // Redirect after a delay
        setTimeout(() => {
          window.location.href = "https://brickapp.com.ng";
        }, 2000);

        // Show manual button as a fallback
        redirectBtnEl.style.display = "block";
      } else {
        headingEl.textContent = "Verification Failed";
        subTextEl.textContent = data.message || "An error occurred during verification. The link may have expired.";
      }
    } catch (err) {
      headingEl.textContent = "Network Error";
      subTextEl.textContent = "Could not connect to the server. Please check your internet connection and try again.";
    }
  }

  // Call the function when the page loads
  verifyEmail();
</script>

</body>
</html>
