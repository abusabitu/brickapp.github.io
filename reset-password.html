<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Brick — Reset Password</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#fff;
    --muted:#666;
    --muted-2:#999;
    --black:#111;
    --active:#333;
    --success: #16a34a;
    --danger: #e11d48;
    --input-bg:#f7f7f7;
  }
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--black);background:var(--bg)}
  .site-header{padding:18px 28px;border-bottom:1px solid #eee;background:var(--bg)}
  .logo img{height:40px}
  .hero{padding:60px 20px;text-align:center}
  .hero h1{font-size:2rem;margin-bottom:12px}
  .hero p{color:var(--muted);margin-bottom:24px}
  .form-box{
    width:100%;
    max-width:420px;
    margin:0 auto;
    background:var(--bg);
    border:1px solid #f0f0f0;
    box-shadow:0 10px 30px rgba(0,0,0,.05);
    padding:32px;
    border-radius:12px;
    text-align:left;
    box-sizing:border-box;
  }
  label{display:block;margin-bottom:8px;font-weight:600;color:var(--black);font-size:0.95rem}
  .input-group{position:relative;margin-bottom:18px}
  input{
    width:100%;
    padding:16px 50px 16px 14px;
    border-radius:10px;
    border:1px solid #ddd;
    font-size:1rem;
    background:var(--input-bg);
    box-sizing:border-box;
    outline:none;
    transition: box-shadow .12s ease, border-color .12s ease;
  }
  input:focus{border-color:var(--black); box-shadow:0 4px 14px rgba(0,0,0,0.06);}
  .toggle{
    position:absolute;
    right:12px;
    top:50%;
    transform:translateY(-50%);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    width:36px;
    height:36px;
    border-radius:8px;
  }
  .toggle:hover svg *{ stroke: var(--black); }
  .toggle svg { width:22px; height:22px; display:block; }
  .toggle .eye-slash { display:none; } /* initial: show eye, hide slash */
  .toggle.active .eye { display:none; }
  .toggle.active .eye-slash { display:block; }
  button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:10px;
    background:var(--black);
    color:#fff;
    font-weight:700;
    cursor:pointer;
    margin-top:16px;
    font-size:1rem;
  }
  button:disabled{background:#aaa;cursor:not-allowed}
  .msg{margin-top:16px;font-size:.95rem;text-align:center}
  ul.rules{list-style:none;padding:0;margin:14px 0 0;font-size:0.95rem}
  ul.rules li{margin:8px 0;color:var(--muted-2);display:flex;gap:10px;align-items:center}
  ul.rules li.valid{color:var(--success);font-weight:600}
  ul.rules li .dot{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;border-radius:4px}
  ul.rules li .dot.ok{color:var(--success)}
  ul.rules li .dot.no{color:var(--muted-2)}
  .match-note{font-size:0.95rem;margin-top:6px;margin-bottom:12px}
  .match-note.valid{color:var(--success)}
  .match-note.invalid{color:var(--danger)}
  /* responsive */
  @media(max-width:520px){
    .hero{padding:36px 16px}
    .form-box{padding:22px}
    input{padding:14px 44px 14px 12px}
  }
</style>
</head>
<body>

  <!-- header -->
  <div class="site-header">
    <div class="logo"><img src="images/logo.png" alt="Brick logo" onerror="this.style.display='none'"><strong style="font-size:1.05rem;margin-left:8px">Brick</strong></div>
  </div>

  <!-- reset section -->
  <section class="hero" aria-labelledby="resetTitle">
    <h1 id="resetTitle">Reset Your Password</h1>
    <p>Please create a new password for your Brick account.</p>

    <div class="form-box" role="form" aria-describedby="formDesc">
      <div id="formDesc" style="display:none">Password must be at least 8 characters, include an uppercase letter, lowercase letter and a number.</div>

      <label for="password">New Password</label>
      <div class="input-group">
        <input aria-label="New password" type="password" id="password" placeholder="Enter new password" autocomplete="new-password" />
        <button type="button" class="toggle" aria-label="Toggle show password" onclick="toggleView('password', this)">
          <!-- EYE (visible) -->
          <svg class="eye" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
            <circle cx="12" cy="12" r="3" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></circle>
          </svg>
          <!-- EYE-SLASH (hidden) -->
          <svg class="eye-slash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M17.94 17.94A10.97 10.97 0 0 1 12 20c-7 0-11-8-11-8a20.6 20.6 0 0 1 4.11-5.14" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M1 1l22 22" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M14.12 14.12a3 3 0 0 1-4.24-4.24" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>

      <label for="confirm">Confirm Password</label>
      <div class="input-group">
        <input aria-label="Confirm password" type="password" id="confirm" placeholder="Confirm new password" autocomplete="new-password" />
        <button type="button" class="toggle" aria-label="Toggle show confirm password" onclick="toggleView('confirm', this)">
          <svg class="eye" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
            <circle cx="12" cy="12" r="3" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></circle>
          </svg>
          <svg class="eye-slash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M17.94 17.94A10.97 10.97 0 0 1 12 20c-7 0-11-8-11-8a20.6 20.6 0 0 1 4.11-5.14" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M1 1l22 22" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M14.12 14.12a3 3 0 0 1-4.24-4.24" stroke="#666" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>

      <div id="matchNote" class="match-note" aria-live="polite"></div>

      <!-- checklist beneath confirm -->
      <ul class="rules" id="rules" aria-hidden="false">
        <li id="rule-length"><span class="dot no">•</span> At least 8 characters</li>
        <li id="rule-upper"><span class="dot no">•</span> At least 1 uppercase letter</li>
        <li id="rule-lower"><span class="dot no">•</span> At least 1 lowercase letter</li>
        <li id="rule-digit"><span class="dot no">•</span> At least 1 number</li>
      </ul>

      <button id="resetBtn" disabled>Reset Password</button>
      <div id="msg" class="msg" aria-live="polite"></div>
    </div>
  </section>

<script>
  // elements
  const password = document.getElementById('password');
  const confirmPass = document.getElementById('confirm');
  const resetBtn = document.getElementById('resetBtn');
  const matchNote = document.getElementById('matchNote');
  const msg = document.getElementById('msg');

  const rules = {
    length: document.getElementById('rule-length'),
    upper: document.getElementById('rule-upper'),
    lower: document.getElementById('rule-lower'),
    digit: document.getElementById('rule-digit')
  };

  // Toggle show/hide using inline SVGs; toggle .active on button to swap visible SVG
  function toggleView(id, el){
    const input = document.getElementById(id);
    const btn = el;
    if(input.type === 'password'){
      input.type = 'text';
      btn.classList.add('active');
      // darken SVG strokes when active
      btn.querySelectorAll('svg [stroke]').forEach(s=>s.setAttribute('stroke','#333'));
    } else {
      input.type = 'password';
      btn.classList.remove('active');
      btn.querySelectorAll('svg [stroke]').forEach(s=>s.setAttribute('stroke','#666'));
    }
  }

  // live validation
  password.addEventListener('input', validateForm);
  confirmPass.addEventListener('input', validateForm);

  function validateForm(){
    const val = password.value;
    const conf = confirmPass.value;

    // rules checks
    const okLength = val.length >= 8;
    const okUpper = /[A-Z]/.test(val);
    const okLower = /[a-z]/.test(val);
    const okDigit = /[0-9]/.test(val);

    updateRule(rules.length, okLength);
    updateRule(rules.upper, okUpper);
    updateRule(rules.lower, okLower);
    updateRule(rules.digit, okDigit);

    // confirm matching
    if(conf.length > 0){
      if(val === conf){
        matchNote.textContent = '✅ Passwords match';
        matchNote.className = 'match-note valid';
      } else {
        matchNote.textContent = '❌ Passwords do not match';
        matchNote.className = 'match-note invalid';
      }
    } else {
      matchNote.textContent = '';
      matchNote.className = 'match-note';
    }

    const allGood = okLength && okUpper && okLower && okDigit && (val === conf);
    resetBtn.disabled = !allGood;
  }

  function updateRule(el, ok){
    const dot = el.querySelector('.dot');
    if(ok){
      el.classList.add('valid');
      dot.className = 'dot ok';
      dot.textContent = '✓';
      el.style.color = 'var(--success)';
    } else {
      el.classList.remove('valid');
      dot.className = 'dot no';
      dot.textContent = '•';
      el.style.color = 'var(--muted-2)';
    }
  }

  // button click -> call Xano reset endpoint
  resetBtn.addEventListener('click', async () => {
    const newPassword = password.value.trim();
    const token = (new URLSearchParams(window.location.search)).get('token');

    resetBtn.disabled = true;
    msg.textContent = 'Resetting password...';
    msg.style.color = '';

    try{
      const res = await fetch('https://x8ki-letl-twmt.n7.xano.io/api:WEYibcEJ/auth/reset_password', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ token: token, new_password: newPassword })
      });
      const data = await res.json();
      if(res.ok){
        msg.textContent = '✅ Password reset successful. You can now log in.';
        msg.style.color = 'var(--success)';
        // optional: redirect to login after short delay
        setTimeout(()=>{ window.location.href = '/'; }, 2200);
      } else {
        msg.textContent = data.message || '❌ Reset failed.';
        msg.style.color = 'var(--danger)';
      }
    }catch(err){
      msg.textContent = '❌ Network error. Try again.';
      msg.style.color = 'var(--danger)';
    } finally {
      resetBtn.disabled = false;
    }
  });

  // initialize (run validation to set initial state if token prefilled)
  validateForm();
</script>

</body>
</html>
